<!DOCTYPE html>
<html>
    <head>
        <title>Peliculas</title>
        <link rel="stylesheet" href="styles.css" />
    </head>

    <body>
        <header>
            <h1 class="pageName">Peliculas Shidas</h1>
            <p>Buscar</p>
            <nav class="nav main-nav">
                <ul>
                    <li><a href="./index.html">Peliculas</a></li>
                    <li><a href="./registrar.html">Registrar</a></li>
                </ul>
            </nav>
        </header>
        <section>
            <h2 class="pageTitle">Peliculas</h2>
            <div class="categoria">
                <label>Categoria</label>
                <select class='cat' id="cat" onchange="getCategoriaID()">
                    <option value="0">Todo</option>
                    <option value="1">Amor</option>
                    <option value="2">Accion</option>
                    <option value="3">Terror</option>
                </select>
                <script type = "text/javascript" src="script.js"></script>
            </div>
            <div class="peliculas" id="peliculas"></div>
            <script type="text/javascript">
                const API = 'http://127.0.0.1:5000/dashboard'
                fetch(API)
                .then((res) => {return res.json()})
                .then((p) => {console.log(p.peliculas); appendMovies(p.peliculas)})
                .catch((e) => console.log(e))

                function appendMovies(peliculas) {
                    let catID = 0
                    try {
                        catID = localStorage.getItem('cat')
                        localStorage.removeItem('cat')
                    } catch (e) {
                        console.log(e)
                    }
                    var mainContainer = document.getElementById("peliculas")

                    if (catID != 0) {
                        peliculas = peliculas.filter(p => peliculas.caegoriaID == catID);
                    }

                    console.log(peliculas)

                    for (var i = 0; i < peliculas.length; i++) {
                        let div = document.createElement('div')
                        let pid = peliculas[i].peliculaID
                        div.className = 'grid-item'
                        div.innerHTML += 'Título: '.bold() + peliculas[i].titulo + '<br>'
                        div.innerHTML += 'Director: '.bold() + peliculas[i].director + '<br>'
                        div.innerHTML += 'Año: '.bold() + peliculas[i].anio + '<br>'
                        div.innerHTML += 'Categoría: '.bold() + peliculas[i].categoria + '<br>'
                        div.innerHTML += 'Duración: '.bold() + peliculas[i].duracion + ' horas <br><br>'
                        div.innerHTML += 'Protagonistas: <br>'.bold()
                        for (var j = 0; j < peliculas[i].protagonista.length; j++){
                            div.innerHTML += `${j+1}: `.bold() + peliculas[i].protagonista[j].nombre + '<br>'
                        }

                        div.innerHTML += '<br><br>' 
                        let editButton = document.createElement('button')
                        editButton.className= 'edit-button'
                        editButton.innerHTML = 'Edit'
                        editButton.id = 'pid'
                        editButton.onclick= function () {
                            console.log(pid)
                            localStorage.setItem('pid', pid)
                            console.log(pid)
                            location.href = './pelicula.html'
                            return false
                        }
                        div.append(editButton)
                        mainContainer.appendChild(div)
                    }
                }
            </script>
        </section>
    </body>

</html>