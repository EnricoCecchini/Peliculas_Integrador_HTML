<!DOCTYPE html>
<html lang="eng">
<link rel="stylesheet" href="./styles.css">
<script>
    function passBusqueda () {
        let busquedaParam = document.getElementById('busquedaParam').value
        console.log(busquedaParam)
        localStorage.setItem('busquedaParam', busquedaParam)
        return false
    }
    function deletePelicula () {
        let pid = localStorage.getItem('pid')
        const API = `http://127.0.0.1:5000/del_pelicula?pid=${pid}`
        fetch(API)
        .then((res) => {return res.json()})
        .catch((e) => console.log(e))
        return false
    }
</script>

<head>
    <title>Pelicula</title>
</head>
    <body class="body">
        <header>
            <div class="head">
                <h1>Chak's Movie Catalogue</h1>
            </div>
            <div class="divSearch">
                <form action="busqueda.html">
                    <label for="Search" aria-placeholder="param"></label>
                    <input type="text" id="busquedaParam" name="param">
                    <input type="submit" value="Search" onclick="passBusqueda()">
                </form>
            </div>
            <nav class="nav main-nav">
                <ul>
                    <li><a href="./index.html">Peliculas</a></li>
                    <li><a href="./register.html">Registrar</a></li>
                </ul>
            </nav>
        </header>
        <section>
            <h2 class="pageTitle">Editar Pelicula</h2>
            <script type="text/javascript">

                let pid = localStorage.getItem('pid')
                //localStorage.removeItem("pid")
                console.log(pid)

                const API = `http://127.0.0.1:5000/get_pelicula?pid=${pid}`
                fetch(API)
                .then((res) => {return res.json()})
                .then((p) => {console.log(p.pelicula); editPelicula(p.pelicula)})
                .catch((e) => console.log(e))

                function editPelicula(pelicula) {  
                    let datos = document.getElementById('pelicula')

                    let form = document.createElement('form')
                    form.setAttribute('method', 'get')
                    form.setAttribute('action', 'http://127.0.0.1:5000/modify_pelicula')

                    let peliID = document.createElement('input')
                    peliID.setAttribute('type', 'text')
                    peliID.setAttribute('name', 'pid')
                    peliID.setAttribute('value', `${pid}`)
                    peliID.readOnly = true

                    let titulo = document.createElement('input')
                    titulo.setAttribute('type', 'text')
                    titulo.setAttribute('name', 'titulo')
                    titulo.setAttribute('value', `${pelicula.titulo}`)
                    titulo.setAttribute('placeholder', `${pelicula.titulo}`)

                    let director = document.createElement('input')
                    director.setAttribute('type', 'text')
                    director.setAttribute('name', 'director')
                    director.setAttribute('value', `${pelicula.director}`)
                    director.setAttribute('placeholder', `${pelicula.director}`)

                    let categoria = document.createElement('input')
                    categoria.setAttribute('type', 'number')
                    categoria.setAttribute('min', '1')
                    categoria.setAttribute('max', '3')
                    categoria.setAttribute('name', 'categoriaid')
                    categoria.setAttribute('value', `${pelicula.categoriaID}`)
                    categoria.setAttribute('placeholder', `${pelicula.categoria}`)

                    let duracion = document.createElement('input')
                    duracion.setAttribute('type', 'text')
                    duracion.setAttribute('name', 'dur')
                    duracion.setAttribute('value', `${pelicula.duracion}`)
                    duracion.setAttribute('placeholder', `${pelicula.duracion} horas`)

                    let anio = document.createElement('input')
                    anio.setAttribute('type', 'number')
                    categoria.setAttribute('min', '1900')
                    categoria.setAttribute('max', '2099')
                    anio.setAttribute('name', 'anio')
                    anio.setAttribute('value', `${pelicula.anio}`)
                    anio.setAttribute('placeholder', `${pelicula.anio}`)

                    let protags = ''

                    for (var i = 0; i < pelicula.protagonista.length; i++)
                    {
                        if (i < pelicula.protagonista.length-1){
                            protags += pelicula.protagonista[i].nombre + ','
                        } else {
                            protags += pelicula.protagonista[i].nombre
                        }
                    }

                    form.innerHTML = 'Película: '.bold()
                    form.innerHTML += '<br><br>'
                    form.innerHTML += 'ID Película: '
                    form.appendChild(peliID)
                    form.innerHTML += '<br><br>'
                    form.innerHTML += 'Título: '
                    form.appendChild(titulo)
                    form.innerHTML += '<br><br>'
                    form.innerHTML += 'Director: '
                    form.appendChild(director)
                    form.innerHTML += '<br><br>'
                    form.innerHTML += 'Categoría: '
                    form.appendChild(categoria)
                    form.innerHTML += '<br> Amor   - 1'
                    form.innerHTML += '<br> Acción - 2'
                    form.innerHTML += '<br> Terror - 3 '
                    form.innerHTML += '<br><br>'
                    form.innerHTML += 'Duración: '
                    form.appendChild(duracion)
                    form.innerHTML += '<br><br>'
                    form.innerHTML += 'Año: '
                    form.appendChild(anio)
                    form.innerHTML += '<br><br><br>'

                    form.innerHTML += 'Protagonistas: '.bold()
                    form.innerHTML += '<br><br>'
                    
                    let protagonista = document.createElement("TEXTAREA");
                    protagonista.innerHTML = `${protags}`;
                    protagonista.setAttribute('rows', '4');
                    protagonista.setAttribute('name', 'protag')
                    protagonista.setAttribute('value', `${protags}`)
                    protagonista.setAttribute('placeholder', `${protags}`)
                    form.appendChild(protagonista);

                    form.innerHTML += '<br><br><br><br>'

                    let edit = document.createElement('input')
                    edit.setAttribute("type", "submit");
                    edit.setAttribute("value", "Submit");

                    form.appendChild(edit)

                    document.getElementsByTagName("body")[0].appendChild(form)
                }
            </script>
        </section>
    </div>
    <div class="borrar" id="borrar"></div>
        <form>
            <input type="submit" value="Delete" onclick="deletePelicula()"/>
        </form>
    </body>
</html>